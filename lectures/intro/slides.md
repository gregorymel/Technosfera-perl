class:firstpage, title

# Программирование на Perl

## Введение

---

# Преподаватели

.floatright[![Right-aligned image](mons.png)]

Владимир Перепелица

Известный разработчик асинхронно-событийных модулей и приложений на Perl.

Технический директор Облака@Mail.ru.

---

# Преподаватели

.floatright[![Right-aligned image](pushtaev.png)]

Вадим Пуштаев

Разработчик проекта поиск@mail.ru.

Любит Perl как современый язык программирования. Активно отвечает на вопросы на stackoverflow

---

# Преподаватели

.floatright[![Right-aligned image](shulyakovskiy.png)]
Николай Шуляковский

Экс ведущий разработчик проекта Почта@mail.ru

Заместитель технического директора проекта МойМир@mail.ru

---

# Преподаватели

.floatright[![Right-aligned image](anosov.jpg)]
Андрей Аносов

Программирует на perl с 2000 года. 

Работает в команде системной разработки проекта "Мой Мир"

---

# Преподаватели

.floatright[![Right-aligned image](panteleev.jpg)]
Сергей Пантелеев

Ведущий разработчик проекта МойМир@mail.ru

Борец с энтропией.

---

# Преподаватели

.floatright[![Right-aligned image](matveev.jpg)]
Александр Матвеев

Разработчик проекта МойМир@mail.ru

Это же IBM! — Достаточно и половины OS!

---

# Преподаватели

.floatright[![Right-aligned image](reznikov.jpg)]
Антон Резников

Разработчик проекта Облако@mail.ru

---

# Преподаватели

.floatright[![Right-aligned image](kazakov.jpg)]
Александр Казаков

Ведущий разработчик социальной сети "Мой Мир".

Пишу на Perl уже 9 лет.


---

# Преподаватели

.floatright[![Right-aligned image](nurtdinov.jpg)]
Олег Нуртдинов

Экс разработчик проекта Почта@mail.ru

Разработчик проекта Облако@mail.ru.



---

# Преподаватели

.floatright[![Right-aligned image](karbachinskiy.jpg)]
Игорь Карбачинский


---

# Преподаватели

.floatright[![Right-aligned image](yazikov.jpg)]
Языков
Программист проекта Поиск@mail.ru

---

# Преподаватели

.floatright[![Right-aligned image](enshin.jpg)]
Андрей Еньшин
Младший программист проекта Облако@Mail.ru


---

class:note_and_mark title

# Отметьтесь на портале!
 
---

# Содержание

1. .bold_font[Цель курса]
1. История создания языка Perl
1. Сравнение производительности
1. Примеры проектов
1. Документация (perldoc)
1. Настройка окружения
1. Запуск скриптов (perlrun)
1. Модуль Deparse
1. Модуль Data::Dumper
1. Модуль DDP
1. Отладка perl скриптов (perldebug)

---

# Что будем учить?

Язык Perl и его область применения

Основы WEB программирования и роль Perl-а в нём

Написание асинхронных программ на Perl

Метаязык XS

Основы работы с базами данных из языка Perl

---

# Как будем учиться?

11 лекционных занятий

- на каждом занятии будет домашнее задание

- проверка домашних заданий проходит в онлайне, и защищается у того преподавателя, который вёл лекцию

- время на выполнение домашних заданий 1 неделя

1 хакатон

- командная работа над разными компонентами одного приложения

Контрольный рубеж №3 (Экзамен)

- защита домашних заданий по PerlXS и асинхронному программированию

- ответы на вопросы по всем домашним заданиям которые не были защищены или защищены не на максимальный балл

---

# Подготовка к лекциям

У нас есть методичка!

Перед каждой лекцией студент обязан просмотреть материалы по лекции из методички, подготовить вопросы по нему.

Так же принимается фидбек по методичке:

- можно присылать материалы, которые необходимо в неё добавить

- исправление ошибок

---

# Как оцениваются результаты?

Максимальное количество балов, которое можно получить за этот курс - 100

За все домашние задания - 80 (10,10,7,8,7,7,7,8,8,8)

Хакатон - 20

Для получения диплома необходимо набрать 70 балов.

Все студенты получившие диплом будут приглашены на собеседование, для прохождения стажировки.

---

# Содержание

1. Цель курса
1. .bold_font[История создания языка Perl]
1. Сравнение производительности
1. Примеры проектов
1. Документация (perldoc)
1. Настройка окружения
1. Запуск скриптов (perlrun)
1. Модуль Deparse
1. Модуль Data::Dumper
1. Модуль DDP
1. Отладка perl скриптов (perldebug)

---

# История создания языка Perl

.floatright[![Right-aligned image](wall_larry_wall.png)]

18 декабря 1987г. — вышла первая версия языка программирования Perl

Это была универсальная утилита для работы с текстом.

---

# История создания языка Perl

Развитие на то время было мотивированно тем, что программисты из разных стран отправляли Ларри Уоллу предложения по модернизации языка и доработкам

1988 году вышла версия 2.0

1989 году вышла версия 3.0

1991 году вышла версия 4.0

1994 году появляется знаменитая 5 версия языка Perl

При её подготовке было многое переосмыслено, и почти полностью переписано. Он стал модульным в нем появились зачатки ООП

"Настоящее величие в том, сколько свободы вы даёте другим, а не в том, как вам удаётся заставлять других делать то, что вы хотите" - Ларри Уолл

---

# История создания языка Perl

До выхода 5 версии Ларри делал Perl для сообщества и по просьбе сообщества

А начиная с версии 5.0 он стал придерживаться позиции, что теперь этот язык должно делать сообщество само для себя и под свои нужды

---

# История создания языка Perl

Происходит изменение акцентов развития языка

Все занялись написанием модулей

---

# История создания языка Perl

До 2005 года perl занимал в нише web-программирования лидирующее положения

Руководствуясь тем, что PHP было мало, а Java была уже перебором выбор останавливался на Perl

---

# История создания языка Perl

С 2005 года перл начал терять свои позиции в области веб разработки, особенно под давлением PHP

Проигрыш языку, который создавался именно для web-разработки, был логичным

Не было сравнимого по своим функциям IDE

Стоимость разработчика на Perl была намного выше, чем на PHP

Порог входа в PHP ниже

Некрасивые ошибки вида "Internal Server Error"

---

# История создания языка Perl

perl6 в истории развития языка в целом:

Сайт perl6.ru появился в 2003 году

Что то вменяемое можно было написать только к 2010 году

В 2014 году стало все гораздо лучше, но в продакшене мы его еще не увидели

---

# История создания языка Perl

perl6 в истории развития языка в целом:

Сайт perl6.ru появился в 2003 году

Что то вменяемое можно было написать только к 2010 году

В 2014 году стало все гораздо лучше, но в продакшене мы его еще не увидели

25 декабря 2015 года состоялся релиз компилятора Rakudo 2015.12

---

# История создания языка Perl

Как это не парадоксально, но perl6 сыграл очень большую роль в развитии perl5, придав его развитию новый толчок.

Внедрение «современности», а именно полноценная поддержка классов была успешна реализована в perl5

---

# История создания языка Perl

Итого на сегодняшний момент мы имеем хорошо зарекомендовавший себя язык

Огромную быстро растущую библиотеку

Большое, активное сообщество

Язык Perl6 и его отличный прототип, который вносит свои коррективы в развитие perl5

А так же идею сделать perl7, который быстро попадёт в продакшн, основываясь на опыте создания perl6 и надобности perl5

Высокие зарплаты

---

# Содержание

1. Цель курса
1. История создания языка Perl
1. .bold_font[Сравнение производительности]
1. Примеры проектов
1. Документация (perldoc)
1. Настройка окружения
1. Запуск скриптов (perlrun)
1. Модуль Deparse
1. Модуль Data::Dumper
1. Модуль DDP
1. Отладка perl скриптов (perldebug)

---

# Сравнение производительности

Самое слабое место - это математика.

По отношению к языку С проигрыш до 20-30 раз, иногда и больше.

По отношению к js около 2-10 раз

По отношению к python примерно на 10%

По отношению к PHP примерно на 4%

Тяжёлые математические расчеты можно уносить в C + XS или lua, XS+FFI, PDL

???

Perl Data Language набор векторных расширений для языка программирования Perl 5-й версии. Предназначен для научных расчётов и иных задач, связанных с обработкой больших объёмов данных, в том числе: обработка изображений, компьютерное моделирование физических систем.

---

# Сравнение производительности

Регулярные выражения (парсеры)

Perl выигрывает в этом отношении у всех динамических языков и по скорости разработки и по производительности

По сравнению с языком C, perl выигрывает по скорости разработки и немного уступает по производительности

Написать регулярное выражение обычно намного проще чем однопоточный парсер на C

---

# Сравнение производительности

Работа с сетью

Доступность всех необходимых системных вызовов для построения низкоуровневых библиотек

Отличная производительность среди всех динамических языков

Разница с языком C не более чем в 3 раза однако скорость разработки гораздо выше

Связка сеть+регэкспы позволяет быстро писать прототипы, которые во многих случаях можно больше не ускорять за ненадобностью

---

# Содержание

1. Цель курса
1. История создания языка Perl
1. Сравнение производительности
1. .bold_font[Примеры проектов]
1. Документация (perldoc)
1. Настройка окружения
1. Запуск скриптов (perlrun)
1. Модуль Deparse
1. Модуль Data::Dumper
1. Модуль DDP
1. Отладка perl скриптов (perldebug)

---

# Примеры проектов

Сайты визитки. Такие проекты на языке perl сейчас реализовываются крайне редко и это понятно.

Сегодня большая часть веб-разработки — это конструктор.

- Perl занимал нишу языков для веб проектов долгое время только из-за того, что не было других альтернатив
- языки, которые создавались именно для легковесных web-проектов заняли нишу CMS
- не на всех виртуальных хостингах есть поддержка perl
- главная проблема веб-разработки на Perl заключается в том, что вы не можете скачать архив с фреймворком, распаковать, и пихать свой код в папочку src

---

# Примеры проектов

Сайты средней нагрузки и размера

Хороший фреймворк рано или поздно встанет вам поперек работы. У него есть целых два способа сделать это: быть слишком негибким, чтобы вы взвопили в попытках вписаться в него, либо же быть достаточно гибким, чтобы вы взвыли от слабой связанности и размазаности алгоритмов по коду.

Perl выигрывает у других за счёт наличия большого количества инструментов для масштабирования.

---

# Примеры проектов

Монстры

Компании активно использующие Perl в инфаструктуре или имеющие сайты на нем:
- Mail.ru Group
- Yandex
- Amazon
- Booking
- New York Times
- DuckDuckGo
- DigitalOcean
- Buzzfeed
- Abills

Коробочные продукты на Perl:
- Bugzilla
- SpamAssassin
- twiki
- OTRS
- RT

---

# Содержание

1. Цель курса
1. История создания языка Perl
1. Сравнение производительности
1. Примеры проектов
1. .bold_font[Документация (perldoc)]
1. Настройка окружения
1. Запуск скриптов (perlrun)
1. Модуль Deparse
1. Модуль Data::Dumper
1. Модуль DDP
1. Отладка perl скриптов (perldebug)

---

# Документация (perldoc)

- Где можно читать про perl?

---

# Документация (perldoc)

- Где можно читать про perl?
- Откуда брать документацию?

---

# Документация (perldoc)

- Где можно читать про perl?
- Откуда брать документацию?
- Как изучать?

---

# Документация (perldoc)

- Где можно читать про perl?
- Откуда брать документацию?
- Как изучать?

Самое полное и точное собрание документации находится в perldoc-е

---

# Документация (perldoc)

Perldoc — это утилита распространяемая с дистрибутивом perl.

Она помогает:

- быстро находить необходимую информацию

- узнавать о нововведениях

- находить новые и пополнять существующие знания о правильном использовании языка и стилистике написания программ

---

# Документация (perldoc)

С чего начать?

---

# Документация (perldoc)

С чего начать?

Конечно же с запуска perldoc perl

---

# Документация (perldoc)

Тут можно найти название разделов с обучающими материалами

perlrequick, perlretut — быстрое начало работы с регулярными выражениями и полное описание работы с ними

perlboot, perltoot, perltooc, perlbot — perl и ООП или ООП в perl

perlstyle — стилистика написания программ

perlfaq* - часто задаваемые вопросы по перлу

---

# Документация (perldoc)

Так же можно найти и техническую документацию.

perlsyn — синтаксис языка perl.

---

layout:true

# Синтаксис языка

.footer[[perlsyn](http://perldoc.perl.org/perlsyn.html)]

---

* Программа - последовательность конструкций (statement)
* Синтаксис близок к языку C
* Perl заимствовал идеи и конструкции из С, shell, awk, sed

---

# Простые конструкции (`STMT`)

```perl
$a = 42;
print "test";
eval { ... };
do { ... };
my $var;
# Комментарий
```

Простые конструкции возвращают значение

---

# Блок

```perl
* {
statement;
statement;
...
* }
```

---

# Управляющие конструкции

* Условия: `if`, `unless`, `elsif`, `else`
* Циклы: `while`, `until`, `for`, `foreach`
* Безусловный переход: `goto`

---

# Условия - `if`

```perl
if     ( EXPR ) { ... }
```

```perl
if     ( EXPR ) { ... }
else            { ... }
```

```perl
if     ( EXPR ) { ... }
elsif  ( EXPR ) { ... }
```

```perl
if     ( EXPR ) { ... }
elsif  ( EXPR ) { ... }
else            { ... }
```

`elsif`, а не `elseif` или `else if`

---

# Условия - `unless`

```perl
unless ( EXPR ) { ... } # ≣ if ( not EXPR )
```

```perl
unless ( EXPR ) { ... }
else            { ... }
```

```perl
unless ( EXPR ) { ... }
elsif  ( EXPR ) { ... }
```

```perl
unless ( EXPR ) { ... }
elsif  ( EXPR ) { ... }
else            { ... }
```

---

# Циклы - `while` / `until`

---

```perl
while ( EXPR ) { ... }
```
```perl
while ( EXPR ) { ... } continue { ... }
```
```perl
until ( EXPR ) { ... }
```
```perl
until ( EXPR ) { ... } continue { ... }
```

---

# Циклы - `for` / `foreach`

---

# Циклы - `for` / `foreach`

.center[
## `for` ≡ `foreach`
]

---

layout:true

.footer[[perlsyn](http://perldoc.perl.org/perlsyn.html)]

# Циклы - `for` / `foreach`

---

```perl
for ( EXPR; EXPR; EXPR ) { ... }
```

```perl
for ( LIST ) { ... }
```

```perl
STMT for ( LIST );
```

```perl
for VAR ( LIST ) { ... }
```

```perl
for ( LIST ) { ... } continue { ... }
```

```perl
for VAR ( LIST ) { ... } continue { ... }
```

---

layout:true
# Документация (perldoc)

---

Так же можно найти и техническую документацию.

perlsyn — синтаксис языка perl.

perldata — типы данных используемых в перле. Типы данных? В перле есть типы данных?

---

layout:true

.footer[[perldata](http://perldoc.perl.org/perldata.html)]

# Переменные - типы

---

* SCALAR
* ARRAY
* HASH

---

* SCALAR (`$s`, `$s = 1`, `$s = "str"`)
* ARRAY (`@a`, `$a[...]`)
* HASH (`%h`, `$h{key}`, `$h{...}`)

---

* SCALAR (`$s`, `$s = 1`, `$s = "str"`)
 - Number 
 - String
 - Reference
* ARRAY (`@a`, `$a[...]`)
 - Of SCALAR's
* HASH (`%h`, `$h{key}`, `$h{...}`)
 - Key: String
 - Value: SCALAR

---

* SCALAR (`$s`)
    - Number (`$s = 1`, `$s = -1e30`)
    - String (`$s = "str"`)
    - Reference
        - Scalar (`$$r`, `${ $r }`)
        - Array (`@$r`, `@{ $r }`, `$r->[...]`)
        - Hash (`%$r`, `%{ $r }`, `$r->{...}`)
        - Function (`&$r`, `&{$r}`, `$r->(...)`)
        - Filehandle (`*$r`)
        - Reference (`$$r`, `${ $r }`)
* ARRAY (`@a`, `$a[...]`)
* HASH (`%h`, `$h{key}`, `$h{...}`)

---

layout:true
# Документация (perldoc)

Так же можно найти и техническую документацию.

perlsyn — синтаксис языка perl.

perldata — типы данных используемых в перле. Типы данных? В перле есть типы данных? Да там есть 3 типа данных «Скаляр» $var, «Массив» @var, «Ассоциативный массив» (хэш) %var.

perlvar - специальные переменные

---

layout:true
# Документация (perldoc)

---

Так же можно найти и техническую документацию.

perlsyn — синтаксис языка perl.

perldata — типы данных используемых в перле. Типы данных? В перле есть типы данных? Да там есть 3 типа данных «Скаляр» $var, «Массив» @var, «Ассоциативный массив» (хэш) %var.

perlvar - специальные переменные

perlop — операции которые поддерживает перл.

perlsub - всё что касается объявления и использования подпрограмм.

perlfunc - описание встроенных функций

perlpod* - документирование кода

perlmod* - модульность в перле

perlxs*, perlembed, perlcall - интеграция языка perl и C

---

Это набор наверно основных точек документации с которыми вам придётся сталкиваться на протяжении первых лекций и при выполнении домашних заданий.

Но это далеко не все разделы документации которые есть в perldoc

На протяжении всего курса мы будем указывать ссылки на документацию

Так же документацию можно смотреть на http://perldoc.perl.org

---
layout: false
# Содержание

1. Цель курса
1. История создания языка Perl
1. Сравнение производительности
1. Примеры проектов
1. Документация (perldoc)
1. .bold_font[Настройка окружения]
1. Запуск скриптов (perlrun)
1. Модуль Deparse
1. Модуль Data::Dumper
1. Модуль DDP
1. Отладка perl скриптов (perldebug)

---

# Настройка окружения

perl завоевал к себе доверие, за счет того, что был портирован под всевозможные платформы и системы

![Right-aligned image](matrixcpantesters.png)

---

# Настройка окружения

MacOSx сам перл уже предустановлен

А вот для сборки XS-модулей, вам придётся установить себе xcode + “Command line tools”

Подробнее про установку можно прочитать в perldoc perlmacosx

Так же возможно вам может понадобится macports

---

# Настройка окружения

Linux.

Как правило дистрибутив языка перл есть в репозитории системы портов.

Например:

- для CentOS установка выполняется посредством вызова yum install perl
- для Debian: apt-get install perl
- для GenToo: emerge dev-lang/perl
- для FreeBSD: pkg install perl5

Для любителей компилировать всё под свою систему:
- make perl ./Configure -des; make test install

---

# Настройка окружения

Windows.

Тут выбор велик, я отмечу самые популярные из вариантов:

- ActivePerl от ActiveState
- StrawberryPerl
- cygwin

Мы рекомендуем использовать StrawberryPerl

В отличие от ActivePerl он идёт сразу с компилятором mingw и установка модулей в нём становится гораздо удобнее и проще

С ActivePerl надо позаботится о наличие nmake + win32GnuUtils иначе сборка модулей будет для вас мучительной и утомляющей

---

# Настройка окружения

После установки проверяем доступность интерпретатора: perl -v

Выдача будет примерно такой

```bash
This is perl 5, version 18, subversion 2 (v5.18.2) built for 
x86_64-linux-gnu-thread-multi
(with 40 registered patches, see perl -V for more detail)

Copyright 1987-2013, Larry Wall

Perl may be copied only under the terms of either the Artistic License or the
GNU General Public License, which may be found in the Perl 5 source kit.

Complete documentation for Perl, including FAQ lists, should be found on
this system using "man perl" or "perldoc perl".  If you have access to the
Internet, point your browser at http://www.perl.org/, the Perl Home Page.
```

---

# Настройка окружения

Если вы видите, что то в виде «Command not found». Или другие ошибки, то с установкой, что то пошло не так.

Возможно интерпретатор находится за пределами все возможных путей из переменной окружения среды PATH

---

# Содержание

1. Цель курса
1. История создания языка Perl
1. Сравнение производительности
1. Примеры проектов
1. Документация (perldoc)
1. Настройка окружения
1. .bold_font[Запуск скриптов (perlrun)]
1. Модуль Deparse
1. Модуль Data::Dumper
1. Модуль DDP
1. Отладка perl скриптов (perldebug)

---

layout: true

.footer[[perlrun](http://perldoc.perl.org/perlrun.html)]

# Запуск скриптов

---

Разберёмся с запуском и выполнением простейших однострочных скриптов.

Именно с этого и пошло развитие этого языка

Самое приятное — это то, что perl под всеми системами работает одинаково, за исключением системнозависимых библиотек.

---

Ключ -e сообщает интерпретатору, что следующую за ключом строку надо выполнить, как скрипт:

```bash
perl -e 'print "Hello world\n"'
```

Однако будьте аккуратны с кавычками, не все шеллы одинаково с ними работают.

---

layout: false

# Специальные переменные

.footer[[perlvar](http://perldoc.perl.org/perlvar.html)]

Самая важная!
* `$_` - переменная по умолчанию

---

layout: true

.footer[[perlrun](http://perldoc.perl.org/perlrun.html)]

# Запуск скриптов

---

Обычно однострочная программа, обрабатывает данные приходящие ей в стандартном вводе.

Вот простейшая программа которая читает стандартный ввод и распечатывает строки добавляя в начало каждой из них дефис

```bash
cat 'file_name.txt' | \
perl -e 'while(<>){print "- ".$_}'
```

Но кто захочет писать каждый раз такую конструкцию?

```perl
while(<>){}
```

---

Обычно однострочная программа, обрабатывает данные приходящие ей в стандартном вводе.

Вот простейшая программа которая читает стандартный ввод и распечатывает строки добавляя в начало каждой из них дефис

```bash
cat 'file_name.txt' | \
perl -e 'while(<>){print "- ".$_}'
```

Но кто захочет писать каждый раз такую конструкцию?

```perl
while(<>){}
```

Для упрощения написания таких однострочников был придуман ключ -n

```bash
cat 'file_name.txt' | perl -ne 'print "- ".$_'
```

---

layout: false

# Специальные переменные

.footer[[perlvar](http://perldoc.perl.org/perlvar.html)]

* `$"` `$LIST_SEPARATOR` - разделитель при интерполяции в кавычках
* `$,` `$OUTPUT_FIELD_SEPARATOR` - разделитель между элементами списка при выводе
* `$/` `$INPUT_RECORD_SEPARATOR` - разделитель входного потока для readline
* `$\` `$OUTPUT_RECORD_SEPARATOR` - разделитель выходного потока для print
* `$.` `$INPUT_LINE_NUMBER` - номер текущей строки во входном потоке

---

layout: true

.footer[[perlrun](http://perldoc.perl.org/perlrun.html)]

# Запуск скриптов

---

Напишем еще одну программу, которая читает файл в котором записи разделены через ";" и выводит каждую запись на новой строке:
```perl
perl -e '$/=";"; $\="\n"; while(<>){chomp;print $_}'
```

---

Внутри вот такого цикла:

```perl
while(<>){}
```

Переменная $_ будет содержать цельную строку вместе с символом-разделителем заданным в переменной `$/`.
По умолчанию `$/` равен \n

Что бы не использовать команду chomp (отрезающую в конце символ-разделитель) можно использовать флаг `-l` :

- устанавливает переменную $\ (разделитель, который выведен после каждого выполнения команды print)
- устанавливает переменную $/ (разделитель по которому будет делится входящий поток, отдельно его можно выставить с помощью флага -0)
- удаляет из строки $_ последний разделитель (при совместном использовании с флагом -n)

---

Флаг `-p` делает тоже самое, что и флаг `-n`, только в каждую итерацию цикла добавит еще вывод переменной `$_`

Таким образом программу из предыдущего примера можно написать следующим образом.

```bash
perl -pl00120073 -e ''
```

А все строки из файла записать через ";" можно так:

```bash
perl -pl00730012 -e ''
```

Очень похоже на программу, которая сама за нас пишет программы )))

Детальнее можно посмотреть тут: perldoc perlvar, perldoc perlrun

---

Для парсинга более сложных структур файлов, например когда в каждой строке есть записи разделенные определённым разделителем, можно использовать флаг -a совместно с -F

-a добавляет функцию разделяющую входную строку на части и складывает в спецмассив @F

-F устанавливает разделитель, по умолчанию это пробел

Например вам надо прочитать файл-таблицу, в которой каждая строка представляет собой набор полей разделенных ";", проверить третью колонку на наличие там 1 и при выполнении условия вывести значение из 2 колонки

```perl
perl -lnaF';' -e 'if( $F[2] == 1 ){ print $F[1] };'
```

!О переводах строк за нас побеспокоился флаг -l

---

Если ваша программа требует подключения модулей, то подключить модули можно опцией -M, например:

```perl
perl -MJSON::XS -e 'print JSON::XS::encode_json({var1 => 1, var2 => 2})'
```

---

Это не все ключи которые поддерживает перл, но их должно хватить, для начала изучения.

А теперь немного вернёмся к истории. Я уже говорил о том, что perl 5 версии был переосмыслен и почти полностью переписан. Так вот начиная с версии 5.005 был сделан доступ к компилятору.

Теперь мы можем заглянуть во внутренности компилятора perl. Посмотреть как будет выглядеть ваш код, посмотреть на информацию компиляции.

---

Для таких модулей был выделен неймспейс B::

А доступ к компирятору реализован в модуле "O"

```bash
perl -MO=Backend
```

Вот такой нехитрой записью можно определить модуль которому будет передана ваша программа после компиляции.

---

layout: false

# Содержание

1. Цель курса
1. История создания языка Perl
1. Сравнение производительности
1. Примеры проектов
1. Документация (perldoc)
1. Настройка окружения
1. Запуск скриптов (perlrun)
1. .bold_font[Модуль Deparse]
1. Модуль Data::Dumper
1. Модуль DDP
1. Отладка perl скриптов (perldebug)

---

# Модуль Deparse

B::Deparse - очень полезный модуль, который способен превратить опкоды вышедшие после компилятора в перлкод.

Другими словами декомпилировать opcode обратно в perl

B::Concise - бекенд позволяющий посмотреть опкоды как они есть

Возьмём уже известный нам пример:

```bash
perl -pl00730012 -e ''
```

И попробуем воспользоватся модулем O передав ему параметром модуль B::Deparse

```bash
perl -MO=Deparse -pl00730012 -e ''
```

---

# Модуль Deparse

На выходе получим

```perl
BEGIN { $/ = "\n"; $\ = ";"; }
LINE: while (defined($_ = <argv>) ){
    chomp $_;
}
continue {
    die "-p destination: $!\n" unless print $_;
}
-e syntax OK
```

</argv>

---

# Модуль Deparse

B::Deparse можно использовать, как обычный модуль

Если вам необходимо посмотреть на код функции по ссылке на эту функцию

```perl
use B::Deparse;
sub func {
    print 'Hello world!!!'
};

my $deparse = B::Deparse->new("-p", "-sC");
$body = $deparse->coderef2text(\&func);

print $body;
```

Выполнив такую программу, на стандартный вывод мы получим:

```perl
{
    print('Hello world!!!');
}
```

---

# Промежуточные итоги

Итого на данном этапе вы уже знаете

- как установить perl
- где искать документацию
- как запускать простейшие однострочники
- как изучать поведение компилятора с вашими однострочниками

Далее мы перейдём к модулю который помогает разворачивать сложные структуры данных

---

# Содержание

1. Цель курса
1. История создания языка Perl
1. Сравнение производительности
1. Примеры проектов
1. Документация (perldoc)
1. Настройка окружения
1. Запуск скриптов (perlrun)
1. Модуль Deparse
1. .bold_font[Модуль Data::Dumper]
1. Модуль DDP
1. Отладка perl скриптов (perldebug)

---

# Модуль Data::Dumper

Data::Dumper - модуль, который поможет выводить на экран в развернутом виде сложные структуры данных.

```perl
use Data::Dumper;
my $foo = [{a => 1, b => 2},{c => 3, d => 4}];
print Dumper($foo);
```

Вот так красиво демонстрирует эту переменную Data::Dumper

```perl
$VAR1 = [
  {
    'b' => 2,
    'a' => 1
  },
  {
    'c' => 3,
    'd' => 4
  }
];
```

---

# Содержание

1. Цель курса
1. История создания языка Perl
1. Сравнение производительности
1. Примеры проектов
1. Документация (perldoc)
1. Настройка окружения
1. Запуск скриптов (perlrun)
1. Модуль Deparse
1. Модуль Data::Dumper
1. .bold_font[Модуль DDP]
1. Отладка perl скриптов (perldebug)

---

# Модуль DDP (Data::Printer)

Есть альтернативный модуль для просмотра структур и объектов. Его обычно используют для дебага приложений.

У этого модуля не меньше настроек, чем у Data::Dumper, но его проще использовать, например:

```perl
use DDP;
my $foo = {a=>1, b=> 2, c=> [1,2,3]};
p $foo;

```

На выходе:

```perl
\ {
  a   1,
  b   2,
  c   [
    [0] 1,
    [1] 2,
    [2] 3
  ]
}
```

---

# Модуль DDP (Data::Printer)

Некоторые отличия от Data::Dumper

Автор этого модуля позаботился о цветовой разметке выводимых данных, для удобства чтения.

Так же у этого модуля более расширенный дамп объектов, но нет сериализации

```perl
\ SomeClass  {
    Parents       Moose::Object
    Linear @ISA   SomeClass, Moose::Object
    public methods (3) : bar, foo, meta
    private methods (0)
    internals: {
        _something => 42,
    }
}
```

---

# Содержание

1. Цель курса
1. История создания языка Perl
1. Сравнение производительности
1. Примеры проектов
1. Документация (perldoc)
1. Настройка окружения
1. Запуск скриптов (perlrun)
1. Модуль Deparse
1. Модуль Data::Dumper
1. Модуль DDP
1. .bold_font[Отладка perl скриптов (perldebug)]

---

layout: true

# Отладка perl скриптов

.footer[[perldebug](http://perldoc.perl.org/perldebug.html)]

---

Для начала работы с дебагером рекомендую прочитать документацию perldebtut

Запуск отладчика выполняется добавлением ключа -d при запуске интерпретатора

perl -d myscript.pl

Для того, что бы отладчик запустился скрипт не должен содержать синтаксических ошибок и должен нормально компилироваться perl -c

---

После запуска отладчика вы увидите на экране

```bash
Loading DB routines from perl5db.pl version 1.44
Editor support available.

Enter h or 'h h' for help, or 'perldoc perldebug' for more help.

DB<1>
```
#
</1>

Далее отладчик ждёт от вас команд

---

Отладка программ подразумевает построчное их выполнение с возможностью просмотра состояния переменных между ними.

Одним из вариантов отладки является вывод в STDERR состояние переменных в том или ином месте кода.

Каждый из вариантов является по своему удобный.

---

Как это выглядит. Скрипт:

```prel
use strict;

my $ret = 0;

foreach(my $i = 0; $i < 50; $i++){
    if($ret>$i){
        $ret -= $i;
    }
    else {
        $ret += $i;
    }
}
print $ret;
```

---

Запускаем

```bash
perl -d mydebug.pl
```
Отладчик запустился и выдал приглашение

```bash
Loading DB routines from perl5db.pl version 1.44
Editor support available.

Enter h or 'h h' for help, or 'perldoc perldebug' for more help.

main::(mydebug.pl:3):   my $ret = 0;

DB< 1 >
```

---

Просмотр кода с текущей позиции командой l

```perl
3==>    my $ret = 0;
4:      my $cnt_add = 0;
5:      my $cnt_sub = 0;
6
7:      foreach(my $i = 0; $i < 50; $i++){
8:              if($ret>$i){
9:                      $ret -= $i;
10              }
11              else {
12:                     $ret += $i;
```

Установим точку останова на 8 строку при достижении 10 итерации цикла:

```
b 8 $i == 9
```

Запустим программу

```
c
```

---

Когда выполнится условие $i == 9 сработает точка останова и на экране появится сообщение

```
DB< 7 >
c
main::(mydebug.pl:8):           if($ret > $i){
```

Выведем значение переменной $i

```
DB< 7 > print $i
9
```

А так же поставим отслеживаться переменную $ret:

```
w $ret
```

---

Выполним следующую строку скрипта:

```
DB< 9 >
n
Watchpoint 0:   $ret changed:
old value:  ''
new value:  '16'
main::(mydebug.pl:9):                   $ret -= $i;

DB< 9 >
```

Дальнейшая отладка происходит по тем же принципам

---

layout: false

# Домашнее задание

1. Написать однострочную программу на perl, которая на вход получает список файлов выводимых командой ls -l или dir, полученный поток разбивает на колонки и выводит в виде таблицы с разделителем ';'. (Важно, имена файлов не должны содержать символа разделителя, но могут содержать пробелы). Результат работы программы средствами шела сохраняем в файл.
2. Написать однострочную программу, которая прочитает со стандартного входа файл созданый в 1 задании. И выведет на экран название файлов размер которых больше 1 мегабайта. Последней строкой надо вывести общее кол-во строк в таблице, и количество строк удовлетворяющее условию.
3. Написать программу которая возьмёт файл из задания 1 и построит структуру данных в виде массива массивов, после чего распечатает его при помощи модулей DDP и Data::Dumper
4. Провести отладку скрипта написанного в задании 3. Создать файл сценарий для отладчика.

---

class:lastpage title

# Спасибо за внимание!

## Оставьте отзыв

.teacher[![teacher]()]
